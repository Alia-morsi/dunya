{% extends "makam/base.html" %}
{% load makam.inline %}
{% load carnatic.badges %}
{% load staticfiles %}
{% block extra_css %}
{% if debug %}
{% load less %}
{% load static %}
<link rel="stylesheet" type="text/css" href="{% get_static_prefix %}{% less "makam/css/pages.less" %}" />
<link rel="stylesheet" type="text/css" href="{% get_static_prefix %}{% less "makam/css/recording.less" %}" />
{% else %}
<link rel="stylesheet" type="text/css" href="{% static "makam/css/pages.css" %}" />
<link rel="stylesheet" type="text/css" href="{% static "makam/css/recording.css" %}" />
{% endif %}
{% endblock %}

{% block title %}{{recording.title}} - {% endblock %}

{% block script %}
<style type="text/css">
#capcal{
    background: url("/static/carnatic/img/capcal.png") 0 0 repeat-y !important;
}
  #capcalTotal {
      height: 94% !important;
  }
  #detail.recording #header #scrollrec #meta .metaBlock .metaMask .metaContainer .metaDetails span label {
      width: 14% !important;
  }
  #detail.recording #header #scrollrec #summary #innerSummary span h1 {
      font-size: 14px !important;
  }
  #detail.recording .alldata .container .thedata #renderTotal #smallcanvas {
      opacity: 1;
  }
  #detail.recording .alldata .container .thedata #renderTotal #miniviewHighlight {
      background: none;
      height: 64px;
      z-index: 4;
  }
  #banshis {
      position: relative;
      height: 25px;
      font-size: 15px;
  }
  #banshis .banshi {
      position: absolute;
      height: 25px;
      margin: 2px;
  }
  #percussions {
      position: relative;
      height: 25px;
      font-size: 15px;
  }
  #percussions .percussion {
      position: absolute;
      height: 25px;
      margin: 2px;
  }
  #timecodes {
      position: relative;
      height: 20px;
  }
  #timecodes span {
      position: absolute;
      height: 25px;
      margin: 2px;
  }
  #timecodes .timecode1 {
      left: 0px;
  }
  #timecodes .timecode2 {
      left: 220px;
  }
  #timecodes .timecode3 {
      left: 445px;
  }
  #timecodes .timecode4 {
      left: 670px;
  }
  #timecodes .timecode5 {
      right: 0px;
  }
  #excerpt{
      padding-top:0 !important;
  }
  svg a {
      color: #000000 !important;
  }
  #score{
      overflow: hidden;
  }
  #score-cont{
      position: relative;
  }
  #no-score{
      margin: 30px 0 0 20px;
      color: #46433a;
      font-size: 30px;
      font-family: "Roboto", sans-serif;
      font-weight: 300;
  }
  #overlap-pitch, #overlap-histogram, #histogram-current-note{
      position: absolute; 
      left: 0px; 
      top: 0px; 
      z-index: 2;
  }
  #histogramcanvas{
    filter: alpha(opacity=70);
      opacity: 0.7;
  
  }
  #overlap-pitch{
      z-index: 3;
  }
  .works-info{
      cursor: pointer;
      float: left;
  }
  .work-head{
     width: 85%; 
  }
  .work-name{
      text-align: center;
      position: absolute;
      top: 70;
      display: none;
      border-radius: 5px;
      border-top: 1px solid #ccc;
  }
  #freq-info, #current-note{  
    display: none;
    position: absolute;
    z-index: 5;
    background-color: white;
    border: thin solid black;
    padding: 2px;
  }
  #current-note{
    top: 5px;
    left: 100px;
  }
  .work-box{
      background-color: #f9f6f5;
      border: 1px solid #ebe2df;
      border-radius: 2px;
      float: left;
      width: 90%;
  }
  .work-box a{
      font-size: 14px;
      text-decoration: none;
  }
  .metaDetails{
      font-size: 14px !important;
  }
  .metaDetails span{
    margin-top: 16px !important;
  }
  .works-info:after {
      content: "\039e";
      position: relative;
      right: -156px;
      top: -22px;
  }
  .work-mb{
      display: inline; 
      margin-left: 0; 
  }
  .no-close .ui-dialog-titlebar-close {
      display: none;
  }
  #score .lyric{
      margin-left: 5px;
  }
  .highlight{
      color: red;
      font-weight: bold;
  }
  .lyric{
      font-size: 22px;
  }
  .lyric-line{
      width: 50%;
      margin: auto;
  }
</style>

<script>
var alignment = '{"alignedLyricsSyllables": [[[[20.910014, 21.410014, "Gel", 129]], [[21.450014, 21.860014, "g\xfc", 130], [21.860014, 22.080014, "ze", 131], [22.080014, 23.510013999999998, "lim", 132]], [[23.520014, 24.060014, "\xc7am", 133], [24.060014, 24.640014, "l\u0131", 134], [24.640014, 25.070014, "ca", 136], [25.070014, 25.740014000000002, "ya", 138]], [[25.880014, 28.240014000000002, "bu", 140]], [[28.300014, 28.670014000000002, "ge", 151], [28.670014000000002, 29.550013999999997, "ce", 152]]], [[[31.201138999999998, 31.551139, "Gel", 161]], [[31.561138999999997, 32.011139, "g\xfc", 162], [32.011139, 32.331139, "ze", 163], [32.331139, 33.711138999999996, "lim", 164]], [[33.731139, 34.211138999999996, "\xc7am", 165], [34.211138999999996, 34.661139, "l\u0131", 166], [34.661139, 35.091139, "ca", 168], [35.091139, 35.771139, "ya", 170]], [[35.911139, 38.271139, "bu", 172]], [[38.281138999999996, 38.741139, "ge", 183], [38.741139, 39.651139, "ce", 184]]], [[[41.259104, 42.859104, "G\xfcn", 191]], [[42.919104000000004, 43.379104000000005, "do\u011f", 193], [43.379104000000005, 43.519104, "ma", 195], [43.519104, 44.989104000000005, "dan", 196]], [[45.109104, 45.359104, "a", 198]], [[45.369104, 45.659104, "ca", 199], [45.659104, 45.909104, "n\u0131m", 200]], [[45.919104000000004, 46.139104, "g\xf6", 201], [46.139104, 46.489104000000005, "r\xfc", 202], [46.489104000000005, 46.779104000000004, "\u015fe", 203], [46.779104000000004, 47.169104000000004, "lim", 204]], [[47.179104, 48.439104, "giz", 205], [48.439104, 48.859104, "li", 210], [48.859104, 49.569104, "ce", 212]]], [[[51.195489, 52.995489000000006, "G\xfcn", 217]], [[53.005489000000004, 53.435489000000004, "do\u011f", 219], [53.435489000000004, 53.63548900000001, "ma", 221], [53.63548900000001, 55.235489, "dan", 222]], [[55.365489000000004, 55.555489, "a", 224]], [[55.565489, 55.765489, "ca", 225], [55.765489, 56.185489000000004, "n\u0131m", 226]], [[56.225489, 56.615489000000004, "g\xf6", 227], [56.615489000000004, 57.045489, "r\xfc", 228], [57.045489, 57.315489, "\u015fe", 229], [57.315489, 57.735489, "lim", 230]], [[57.765489, 58.925489000000006, "giz", 231], [58.925489000000006, 59.225489, "li", 237], [59.225489, 59.915489, "ce", 239]]], [[[61.56293, 62.152930000000005, "B\xfcl", 244], [62.152930000000005, 62.722930000000005, "b\xfcl", 245], [62.722930000000005, 63.30293, "le", 247], [63.30293, 64.06293000000001, "rin", 251]], [[64.07293, 64.62293, "ef", 252], [64.62293, 65.24293, "ga", 253], [65.24293, 65.80293, "n\u0131", 255], [65.80293, 66.55293, "n\u0131", 259]], [[66.56293000000001, 66.94293, "din", 260], [66.94293, 67.21293, "le", 261], [67.21293, 67.46293, "ye", 262], [67.46293, 67.64293, "lim", 263]], [[67.65293, 68.79293, "yan", 264], [68.79293, 69.10293, "ya", 269], [69.10293, 69.85293, "na", 270]]], [[[71.63194600000001, 72.35194600000001, "B\xfcl", 275], [72.35194600000001, 72.951946, "b\xfcl", 277], [72.951946, 73.54194600000001, "le", 278], [73.54194600000001, 74.34194600000001, "rin", 282]], [[74.35194600000001, 75.001946, "ef", 283], [75.001946, 75.721946, "ga", 284], [75.721946, 76.35194600000001, "n\u0131", 286], [76.35194600000001, 77.29194600000001, "n\u0131", 290]], [[77.301946, 77.71194600000001, "din", 291], [77.71194600000001, 78.01194600000001, "le", 292], [78.01194600000001, 78.331946, "ye", 293], [78.331946, 78.611946, "lim", 294]], [[78.62194600000001, 79.721946, "yan", 295], [79.721946, 80.01194600000001, "ya", 299], [80.01194600000001, 80.84194600000001, "na", 301]]], [[[82.623867, 84.403867, "Kum", 308], [84.403867, 84.97386700000001, "ru", 309]], [[84.983867, 85.343867, "gi", 311], [85.343867, 87.003867, "bi", 312]], [[87.013867, 87.203867, "a", 314]], [[87.21386700000001, 87.673867, "ca", 315], [87.673867, 88.05386700000001, "n\u0131m", 316]], [[88.063867, 88.323867, "se", 317], [88.323867, 88.60386700000001, "vi", 318], [88.60386700000001, 88.903867, "\u015fe", 319], [88.903867, 89.203867, "lim", 320]], [[89.21386700000001, 90.233867, "can", 321]], [[90.24386700000001, 90.453867, "ca", 326], [90.453867, 91.173867, "na", 328]]], [[[92.831044, 94.471044, "Kum", 333], [94.471044, 94.971044, "ru", 334]], [[94.98104400000001, 95.271044, "gi", 336], [95.271044, 96.64104400000001, "bi", 337]], [[96.65104400000001, 96.84104400000001, "a", 339]], [[96.851044, 97.09104400000001, "ca", 340], [97.09104400000001, 97.28104400000001, "n\u0131m", 341]], [[97.29104400000001, 97.491044, "se", 342], [97.491044, 97.76104400000001, "vi", 343], [97.76104400000001, 97.971044, "\u015fe", 344], [97.971044, 98.191044, "lim", 345]], [[98.211044, 99.14104400000001, "can", 346]], [[99.191044, 99.461044, "ca", 352], [99.461044, 100.06104400000001, "na", 354]]], [[[173.62424000000001, 175.43424000000002, "Kum", 308], [175.43424000000002, 175.95424, "ru", 309]], [[175.96424000000002, 176.32424, "gi", 311], [176.32424, 178.21424000000002, "bi", 312]], [[178.22424, 178.47424, "a", 314]], [[178.48424, 178.71424000000002, "ca", 315], [178.71424000000002, 178.87424000000001, "n\u0131m", 316]], [[178.88424, 179.18424000000002, "se", 317], [179.18424000000002, 179.52424000000002, "vi", 318], [179.52424000000002, 179.87424000000001, "\u015fe", 319], [179.87424000000001, 180.32424, "lim", 320]], [[180.33424, 181.52424000000002, "can", 321]], [[181.53424, 181.82424, "ca", 326], [181.82424, 182.83424, "na", 328]]], [[[184.623791, 186.46379100000001, "Kum", 333], [186.46379100000001, 187.003791, "ru", 334]], [[187.01379100000003, 187.383791, "gi", 336], [187.383791, 189.153791, "bi", 337]], [[189.21379100000001, 189.503791, "a", 339]], [[189.51379100000003, 189.80379100000002, "ca", 340], [189.80379100000002, 190.093791, "n\u0131m", 341]], [[190.103791, 190.26379100000003, "se", 342], [190.26379100000003, 190.70379100000002, "vi", 343], [190.70379100000002, 190.89379100000002, "\u015fe", 344], [190.89379100000002, 191.153791, "lim", 345]], [[191.163791, 192.45379100000002, "can", 346]], [[192.503791, 192.80379100000002, "ca", 352], [192.80379100000002, 193.73379100000002, "na", 354]]]], "sectionlinks": {"instrumentation": "solo singing", "work_relations": [{"mbid": "9aaf5c0b-4642-40fd-97ba-c861265872ce", "title": "Gel G\xfczelim \xc7aml\u0131ca\'ya"}], "section_annotations": [{"melodicStructure": "ARANAGME_1", "time": [0.420003, 20.867514], "time_unit": "sec", "lyricStructure": "INSTRUMENTAL", "name": "Aranagme"}, {"melodicStructure": "B1", "time": [20.867514, 31.168639], "time_unit": "sec", "lyricStructure": "B1", "name": "Zemin"}, {"melodicStructure": "B2", "time": [31.168639, 41.226604], "time_unit": "sec", "lyricStructure": "B1", "name": "Zemin"}, {"melodicStructure": "C1", "time": [41.226604, 51.162989], "time_unit": "sec", "lyricStructure": "C1", "name": "Nakarat"}, {"melodicStructure": "D1", "time": [51.162989, 61.53043], "time_unit": "sec", "lyricStructure": "C1", "name": "Nakarat2"}, {"melodicStructure": "E1", "time": [61.53043, 71.389446], "time_unit": "sec", "lyricStructure": "D1", "name": "Meyan"}, {"melodicStructure": "F1", "time": [71.389446, 82.591367], "time_unit": "sec", "lyricStructure": "D1", "name": "Meyan2"}, {"melodicStructure": "C2", "time": [82.591367, 92.798544], "time_unit": "sec", "lyricStructure": "E1", "name": "Nakarat"}, {"melodicStructure": "D2", "time": [92.798544, 101.419656], "time_unit": "sec", "lyricStructure": "E1", "name": "Nakarat2"}, {"time": [101.419656, 173.57174], "time_unit": "sec", "name": "Gazel"}, {"melodicStructure": "C2", "time": [173.57174, 184.591291], "time_unit": "sec", "lyricStructure": "E1", "name": "Nakarat"}, {"melodicStructure": "D2", "time": [184.591291, 195.478209], "time_unit": "sec", "lyricStructure": "E1", "name": "Nakarat2"}], "symbTr": "nihavent--sarki--aksak--gel_guzelim--faiz_kapanci", "title": "Gel G\xfczelim \xc7aml\u0131ca\'ya"}}';
var pitchMax = "{{max_pitch}}";
var pitchMin = "{{min_pitch}}";
var histogramurl = "{{histogramurl|safe}}";
var notemodelsurl = "{{notemodelsurl|safe}}";
var pitchtrackurl = "{{pitchtrackurl|safe}}";
var waveformurl = "{{waveform|safe}}";
var scoreurl = "{{scoreurl|safe}}";
var indexmapurl = "{{indexmapurl|safe}}";
var specurl = "{{spectrogram|safe}}";
var smallurl = "{{smallimage|safe}}";
var intervalsurl = "{{intervalsurl|safe}}";
var notesalignurl = "{{notesalignurl|safe}}";
var sectionsurl = "{{sectionsurl|safe}}";
var documentsurl = "{{documentsurl|safe}}";
var secondsPerView = 8;
var ratioUsedView = 0.5;
var pitchtrackdata = null;
var histogramdata = null;
var rhythmdata = null;
var aksharadata = null;
var audiourl = "{{audio|safe}}";
var recordinglengthfmt = "{% if recording.length %}{{recording.length_format}}{% endif %}";
var recordinglengthseconds = "{%if recording.length %}{{recording.length_seconds}}{% endif %}";
var tonicurl = "{{tonicurl}}";
var worksurl = "{{worksurl}}";
var phraseurl = "{{phraseurl}}";
var ahenkurl = "{{ahenkurl}}";

{% if user.is_authenticated %}
function playrecord(){
    if(plButton.hasClass("stop")){
        pause();
        plButton.removeClass("stop");
    }else{
        play();
        plButton.addClass("stop");
    }
}
{% else %}
$(function() {
    $( "#playback_dialog" ).dialog( "open" );
  });
{% endif %}

widthOfChildren(".metaContainer");
</script>
<script src="{% static "makam/js/lyric_alignment.js" %}"></script>
{% endblock %}

{% block wrap %}
{% if bootleg %}
<div id="bootleg-bar">
    <div style="float:left">
        <p>This is a bootleg recording only visible to CompMusic researchers.
        <br>Do not share.</p>
    </div>
    <div style="float:right; margin-top:10px;margin-right:10px;">
        <button onclick="$("#bootleg-bar").hide()">Ok</button>
    </div>
</div>
{% endif %}
<div id="detail" class="recording">
    <div id="header">
        <div id="scrollrec">
            <div id="summary">
                <div id="innerSummary">
                    <span>
                        <a class="work-mb" href="http://musicbrainz.org/recording/{{recording.mbid}}"><img width="16px" src="{% static "makam/img/mb.png" %}" /></a>
                        <h1 style="display: inline;">{{recording.title}}</h1>
                        <h2> by {{recording.artists.all|join:", " }} </h2>
                    </span>
                </div>
                <div id="summaryBack"></div>
            </div>
            <div id="meta">
                <div class="metaBlock">
                    <div class="metaMask">
                        <div class="metaContainer">
                            <div id="excerpt" class="metaDetails recordingDetails">
                                <span class="list">
                                    {% for w in  recording.releaselist%}
                                        <label>Album</label><b><span>
                                            <a class="work-mb" href="http://musicbrainz.org/release/{{w.mbid}}"><img width="16px" src="{% static "makam/img/mb.png" %}" /></a>
                                            {{ w }}</span></b>
                                    {% endfor %}
                                    <label>Compositions</label><b><span>&nbsp;</span></b>
                                    {% for w in recording.works.all %}
                                    <div class="work-box">
                                        <span class="works-info">
                                          <div class="work-head">
                                            <a class="work-mb" href="http://musicbrainz.org/work/{{w.mbid}}"><img width="16px" src="{% static "makam/img/mb.png" %}" /></a>
                                            <a class="work-ref" href="#" ref="#work-{{w.mbid}}">{{w}}</a>
                                          </div>
                                        </span>
                                        <div class="work-info" id="work-{{w.mbid}}" style="display:none">
                                            {% for c in w.composerlist.all %}
                                            <label>Composer</label><b><span>
                                                
                                                <a class="work-mb" href="http://musicbrainz.org/artist/{{c.mbid}}"><img width="16px" src="{% static "makam/img/mb.png" %}" /></a>
                                                <a href="{% url "work-list" %}?artist={{c.id}}">{{c}}</a></span></b>
                                            {% endfor %}
                                            {% for c in w.lyricistlist.all %}
                                            <label>Lyricist</label><b><span>
                                                <a class="work-mb" href="http://musicbrainz.org/artist/{{c.mbid}}"><img width="16px" src="{% static "makam/img/mb.png" %}" /></a>
                                                <a href="{% url "work-list" %}?artist={{c.id}}">{{c}}</a></span></b>
                                            {% endfor %}
                                            {% for m in w.makam.all %}
                                            <label>Makam</label><b><span><a href="{% url "work-list" %}?makam={{m.id}}">{{m}}</a></span></b>
                                            {% endfor %}
                                            {% for f in w.form.all %}
                                            <label>Form</label><b><span><a href="{% url "work-list" %}?form={{f.id}}">{{f}}</a></span></b>
                                            {% endfor %}
                                            {% for u in w.usul.all %}
                                            <label>Usul</label><b><span><a href="{% url "work-list" %}?usul={{u.id}}">{{u}}</a></span></b>
                                            {% endfor %}
                                        </div>
                                     </div>
                                    {% endfor%}
                                <label>Performers</label><b>
                                    {% for a in recording.instrumentperformance_set.all %}
                                      <span><a class="work-mb" href="http://musicbrainz.org/artist/{{a.artist.mbid}}"><img width="16px" src="{% static "makam/img/mb.png" %}" /></a>
                                        {{ a.artist }}{%if a.instrument%}({{ a.instrument }}){%endif%}</span>
                                    {% endfor%}
                                </b>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="totalcontrol">
            <div id="control">
                <div class="revButton"></div>
                <div class="plButton" onclick="playrecord();"></div>
                <div class="folButton"></div>
            </div>
        </div>
        <div style="padding-top:6px; margin-right:1em;">
        </div>
        <div class="clearfix"></div>
    </div><!-- HEADER END -->

    <div class="alldata">
        <div class="container">
            <div class="thedata">
                <div id="rendersMask" style="height:680px;">
                    <div id="renders">
                        <div id="capcal" style="height:255px;"></div>

                        <div id="bigPitch">
                            <canvas id="overlap-pitch" style="width:900px; height:256px;"></canvas>
                            <canvas id="pitchcanvas" style="width:900px; height:256px;"></canvas>
                            <div id="zooms" style="bottom: 5px;">
                                <!-- <a class="zoom zoom1 selected" data-length="32" href="#">x1</a>
                                    <a class="zoom zoom2" data-length="16" href="#">x2</a>
                                    <a class="zoom zoom3" data-length="8" href="#">x3</a>
                                    <a class="zoom zoom3" data-length="4" href="#">x4</a>-->
                            </div>
                        </div>


                        
                        <div>
                            <div id="timecodes">
                                <span class="timecode1"></span>
                                <span class="timecode2"></span>
                                <span class="timecode3"></span>
                                <span class="timecode4"></span>
                                <span class="timecode5"></span>
                            </div>
                            <div id="score" style="height:300px; width:900px;">
                            </div>
                        </div>
                        <div id="renderTotal">
                            <div id="capcalTotal"></div>
                            <div id="timepoint"></div>
                            <div id="miniviewHighlight"></div>
                            <canvas id="smallcanvas"></canvas>
                            {% for w in recording.works.all %}
                                <div class="work-name" id="work-name-{{w.mbid}}"><a href="#" class="work-ref" ref="#work-{{w.mbid}}">{{w}}</a></div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="container2">
                    <div class="waveLabel">
                      <canvas id="overlap-histogram" style="width:200px; height:256px;"></canvas>
                      <canvas id="histogram-current-note" style="width:200px; height:256px;"></canvas>
                      <canvas id="histogramcanvas" style="height:256px; width:200px;"></canvas>
                      <div id="freq-info"></div>
                      <div id="current-note"></div>
                    </div> 
                    <div id="totalcontrol2">
                        <div id="timecode">00:00<span>{% if recording.length %}{{recording.length_format}}{% endif %}</span></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="thedata">
        <div class="leftdata">
            <!--<h3>Similar recordings</h3>-->
        </div>

        <div class="rightdata">
            <div class="innerrightdata scrolldata nopad">
                <div class="tracklist">
                    {% for s in similar %}
                    {% badge_similar_recording s %}
                    {% endfor %}
                </div>
                <div class="clearfix"></div>
            </div>
        </div>
    </div>
    <div class="clearfix"></div>
</div>
{% endblock %}

