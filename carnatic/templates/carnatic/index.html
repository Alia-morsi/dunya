{% extends "carnatic/base.html" %}
{% load inline %}
{% load badges %}
{% load staticfiles %}

{% block script %}
<script>
var qartist = {{qartist}};
var qinstr = {{qinstr}};
var qraaga = {{qraaga}};
var qtaala = {{qtaala}};
var qconcert = {{qconcert}};
$(document).ready(function() {
    parseAllFilters({{ filter_items|safe }});
    // If we made a query, re-fill out the search

    if (qartist.length) {
        var eid = "eid1";
        toggleCategory($("div#entitiesList .artist"));
        var thelist = $("div.entity_1 div.filterList ul li");
        for (var i = 0; i < thelist.length; i++) {
            var theitem = $(thelist[i]);
            if ($.inArray(theitem.data("id"), qartist)) {
                theitem.toggleClass("selected");
                getResults2(theitem, eid);
            }
        }
        // Show artist bubble (minimised)
    }
    if (qconcert.length) {
        var eid = "eid2";
        toggleCategory($("div#entitiesList .concert"));
        var thelist = $("div.entity_2 div.filterList ul li");
        for (var i = 0; i < thelist.length; i++) {
            var theitem = $(thelist[i]);
            if ($.inArray(theitem.data("id"), qconcert)) {
                theitem.toggleClass("selected");
                getResults2(theitem, eid);
            }
        }
    }
    if (qinstr.length) {
        var eid = "eid3";
        toggleCategory($("div#entitiesList .instrument"));
        var thelist = $("div.entity_3 div.filterList ul li");
        thelist.each(function(theitem) {
            console.debug("theitem"+theitem);
            if ($.inArray(theitem.data("id"), qinstr)) {
                theitem.toggleClass("selected");
                getResults2(theitem, eid);
            }
        });
    }
    if (qraaga.length) {
        var eid = "eid4";
        toggleCategory($("div#entitiesList .raaga"));
        var thelist = $("div.entity_4 div.filterList ul li");
        for (var i = 0; i < thelist.length; i++) {
            var theitem = $(thelist[i]);
            if ($.inArray(theitem.data("id"), qraaga)) {
                theitem.toggleClass("selected");
                getResults2(theitem, eid);
            }
        }
    }
    if (qtaala.length) {
        var eid = "eid5";
        toggleCategory($("div#entitiesList .taala"));
        var thelist = $("div.entity_5 div.filterList ul li");
        for (var i = 0; i < thelist.length; i++) {
            var theitem = $(thelist[i]);
            if ($.inArray(theitem.data("id"), qtaala)) {
                theitem.toggleClass("selected");
                getResults2(theitem, eid);
            }
        }
    }
});
</script>

<script src="{% static 'carnatic/js/browse.js' %}"></script>
{% endblock %}

{% block title %}{% if querytext %}{{querytext}} - {% elif querybrowse %}Browsing - {% endif %}{% endblock %}

{% block wrap %}

<div class="main-container">

    <div id="filterMask">
	    <div id="filterArea">

	    	<div id="entitiesList" class="filterList">
	        	<ul></ul>
	    	</div>

	    	<div id="breadcrumb">
	    	</div>

	    </div>

     </div>

	 <div id="tab">
         {% comment %} to make the search box pop up, don't need it yet{%endcomment%}
         <!--<div id="tabControl"></div>-->
	</div>

	 <div id="resultsstats">
        <table>
        	<tbody><tr>
        		<td>
				    <div id="queryCont">
				    		<span>Query</span>
						<div id="query" class="shadow1" onClick="$('.inforight').isotope({ filter: '*' });">
						</div>
					 </div>
	 			</td>
                <td class="artist" onClick="$('.inforight').isotope({ filter: '.artist' });"><span>{{numartists}}</span> <b>Artists</b></td>
                <td class="concert" onClick="$('.inforight').isotope({ filter: '.concert' });"><span>{{numconcerts}}</span> <b>Concerts</b></td>
                <td class="work" onClick="$('.inforight').isotope({ filter: '.work' });"><span>{{numworks}}</span> <b>Compositions</b></td>
                <td class="instrument" onClick="$('.inforight').isotope({ filter: '.instrument' });"><span>{{numinstruments}}</span> <b>Instruments</b></td>
                <td class="raaga" onClick="$('.inforight').isotope({ filter: '.raaga' });"><span>{{numraagas}}</span> <b>Raagas</b></td>
                <td class="taala" onClick="$('.inforight').isotope({ filter: '.taala' });"><span>{{numtaalas}}</span> <b>Taalas</b></td>
                <td class="composer" onClick="$('.inforight').isotope({ filter: '.composer' });"><span>{{numcomposers}}</span> <b>Composers</b></td>
        	</tr>
        </tbody></table>
     </div>
     {% if query %}
        <h2 class="resultsTitle">Query results:</h2>
     {% else %}
         <h2 class="resultsTitle">Some items from our collection:</h2>
     {% endif %}
     <div class="inforight">
        {% for type, item in results %}
            {% if type == "concert" %}
                {% badge_concert item %}
            {% elif type == "artist" %}
                {% badge_artist item %}
            {% elif type == "instrument" %}
                {% badge_instrument item %}
            {% elif type == "raaga" %}
                {% badge_raaga item %}
            {% elif type == "taala" %}
                {% badge_taala item %}
            {% endif %}
        {% endfor %}
     </div>
    </div>

{% endblock %}
