function removeFilter(e){$(".filterBall").parent().find(".formFilter").addClass("formFilterClosed");$(".filterBall").parent().find(".filterGlobalList").addClass("filterListClosed");$(".filterBall").find(".arrow").addClass("arrowClosed");$(".filterBall").addClass("filterBallClosed");$("#entitiesList").addClass("filterListClosed");$(".filters.entity_"+e).remove();filtersArray.splice(filtersArray.indexOf(e),1)}function loadFilter(e,t){$(".filterBall").parent().find(".formFilter").addClass("formFilterClosed");$(".filterBall").parent().find(".filterGlobalList").addClass("filterListClosed");$(".filterBall").find(".arrow").addClass("arrowClosed");$(".filterBall").addClass("filterBallClosed");$("#entitiesList").addClass("filterListClosed");if(e==1){filterFile="/static/browse/js/carnatic_artists.json";filterName="Artist"}else if(e==2){filterFile="/static/browse/js/carnatic_concerts.json";filterName="Concert"}else if(e==3){filterFile="/static/browse/js/carnatic_works.json";filterName="Work"}else if(e==4){filterFile="/static/browse/js/carnatic_artists.json";filterName="Instrument"}else if(e==5){filterFile="/static/browse/js/carnatic_artists.json";filterName="Raaga"}else if(e==6){filterFile="/static/browse/js/carnatic_recordings.json";filterName="Taala"}getFilterData(filterFile,e,filterName,t)}function getFilterData(e,t,n,r){window.filterData="";$.ajax({url:e,data:"nocache="+Math.random(),type:"GET",dataType:"json",success:function(e){window.filterData=e;showFilterData(t,n,r)},error:function(e){alert("ERROR while loading JSON")}})}function parseAllFilters(){$.each(window.filtersItems,function(e,t){entityHTML="<li class='entity_"+(e+1)+"' entity_id='"+(e+1)+"' eid='eid"+(e+1)+"'><div class='colorCode shadow1'></div>"+t.name+"</li>";$("#entitiesList ul").append(entityHTML);formHTML="<div class='form_"+(e+1)+"'><form>";$.each(t.data,function(e,t){formType=t.type;if(formType=="list"){if(t.multiselect)var n="multiSelect";else var n="select";formHTML+="<fieldset filtertype='"+n+"' filtername='"+t.name+"'>";formHTML+="<label class='formSection'>"+t.name+"</label>";formHTML+="<div class='filterList formFilterItem'><ul>";for(i in t.data)formHTML+="<li the_id='"+(parseInt(i)+1)+"' valor='"+t.data[i]+"'>"+t.data[i]+"</li>";formHTML+="</ul></div></fieldset>"}else if(formType=="rangeslider"){formHTML+="<fieldset filtertype='slideRange' filtername='"+t.name+"'>";formHTML+="<label class='formSection'>"+t.name+"</label>";formHTML+="<div class='formFilterItem'>";formHTML+="<span class='output'></span>";t.step?formHTML+="<div class='slider-range' min='"+t.data[0]+"' max='"+t.data[1]+"' step='"+t.step+"'></div>":formHTML+="<div class='slider-range' min='"+t.data[0]+"' max='"+t.data[1]+"' ></div>";formHTML+="</div></fieldset>"}else if(formType=="text"){formHTML+="<fieldset filtertype='text' filtername='"+t.name+"'>";formHTML+="<label class='formSectionText'>"+t.name+"<input type='text' /></label>";formHTML+="</fieldset>"}});formHTML+="</form></div>";$("#footage").append(formHTML)});loadClicks()}function loadClicks(){$("#gmSelected").click(function(){$("#gmDropDown").show()});$("#entitiesList ul li").click(function(){$(this).hasClass("selected")?removeFilter($(this).attr("entity_id")):loadFilter($(this).attr("entity_id"),$(this).attr("eid"));$(this).toggleClass("selected");$("#summary").attr("class","entity_"+$(this).attr("entity_id"))});$(".filterList.formFilterItem ul li").click(function(){$(this).toggleClass("selected");entity=$(this).parent().parent().parent().parent().parent().parent().parent().attr("eid");filterType=$(this).parent().parent().parent().attr("filtertype");filterName=$(this).parent().parent().parent().attr("filtername");getResults($(this))});$(".formSection").click(function(){$(this).toggleClass("formSectionOpen");$(this).nextAll(".formFilterItem").toggle();$(".formSection").not(this).removeClass("formSectionOpen");$(".formSection").not(this).nextAll(".formFilterItem").hide();topPosition=$(this).position();container=$(this).parent().parent().parent().parent();container.scrollTop(topPosition.top-10);$(this).hasClass("formSectionOpen")?container.addClass("noScroll"):container.removeClass("noScroll")});$(".filterBall").click(function(){nuk=$(this);if($(this).hasClass("filterBallClosed")){$(".filterBall").not(this).parent().find(".formFilter").addClass("formFilterClosed");$(".filterBall").not(this).parent().find(".filterGlobalList").addClass("filterListClosed");$("#entitiesList").addClass("filterListClosed");$(".filterBall").not(this).find(".arrow").addClass("arrowClosed");$(".filterBall").not(this).addClass("filterBallClosed");nuk.find(".arrow").removeClass("arrowClosed");nuk.removeClass("filterBallClosed");nuk.siblings(".formFilter").removeClass("formFilterClosed");nuk.siblings(".filterGlobalList").removeClass("filterListClosed");nuk.siblings("#entitiesList").removeClass("filterListClosed");sumarizeFilter($(this))}else{$(".filterBall").parent().find(".formFilter").addClass("formFilterClosed");$(".filterBall").parent().find(".filterGlobalList").addClass("filterListClosed");$(".filterBall").find(".arrow").addClass("arrowClosed");$(".filterBall").addClass("filterBallClosed");$("#entitiesList").addClass("filterListClosed");sumarizeFilter($(this))}});$("#toggleMain").click(function(){$("#filterMask").toggleClass("querybar")})}function sumarizeFilter(e){summaryHTML="";$.each(filtersLiteralOutputArray[e.parent().attr("eid")],function(e,t){summaryHTML+="<b>"+e+"</b>"+t+"</br>"});e.find(".filterSummary").html(summaryHTML)}function showFilterData(e,t,n){filtersArray.push(e);filterPosition=filtersArray.indexOf(e);$("#filterModel").clone(!0).appendTo("#filterArea").attr("id","filter_"+filterPosition).attr("class","filters entity_"+e).attr("eid",n);entityHTML_bc="<div class='bread entity_"+e+"'><div class='breadarrow'></div><span><a href='#'>No selection</a></span></div>";$("#breadcrumb").append(entityHTML_bc);$("#filterArea").width(480+filtersArray.length*780);newFilter="#filter_"+filterPosition;$(newFilter).find(".filterList").append(listFilterData(e));$(newFilter).find(".filterList ul li").click(function(){$(this).toggleClass("selected");$("#breadcrumb").find(".entity_"+e+" span a").html($(this).html())});$(newFilter).find(".filterBall span").html(t);$(".form_"+e).clone(!0).appendTo($(newFilter).find(".formFilter"));$(newFilter+" .formFilter").removeClass("formFilterClosed");$(newFilter+" .filterList").removeClass("filterListClosed");$(newFilter+" .filterBall .arrow").removeClass("arrowClosed");$(newFilter+" .filterBall").removeClass("filterBallClosed");$(newFilter+" .slider-range").each(function(){$(this).attr("step")?$(this).slider({range:!0,min:parseInt($(this).attr("min")),max:parseInt($(this).attr("max")),step:parseInt($(this).attr("step")),values:[parseInt($(this).attr("min")),parseInt($(this).attr("max"))],slide:function(e,t){$(newFilter).find(".output").html(t.values[0]+" - "+t.values[1]+"<div class='results' first='"+t.values[0]+"' second='"+t.values[1]+"'></div>")}}):$(this).slider({range:!0,min:parseInt($(this).attr("min")),max:parseInt($(this).attr("max")),values:[parseInt($(this).attr("min")),parseInt($(this).attr("max"))],slide:function(e,t){$(newFilter).find(".output").html(t.values[0]+" - "+t.values[1]+"<div class='results' first='"+t.values[0]+"' second='"+t.values[1]+"'></div>")}})});$(newFilter).find(".output").each(function(){$(this).html($(this).siblings().attr("min")+" - "+$(this).siblings().attr("max"))});$(newFilter).find("input").bind("slider:ready slider:changed",function(e,t){if($(this).hasClass("artistGeneration")){result=1912+t.value.toFixed(2)*100;$(this).parent().find(".output").html(result.toFixed())}else{result=t.value.toFixed(2)*100;$(this).parent().find(".output").html(result.toFixed());console.log("change")}})}function listFilterData(e){list="<ul>";$.each(window.filterData,function(t,n){e==2||e==3||e==6?list+="<li>"+n.info.title+"</li>":list+="<li>"+n.info.name+"</li>"});list+="</ul>";return list}function getResults(e){theValue="";theName="";if(filterType=="multiSelect"){theValue=[];theName=[];e.parent().find(".selected").each(function(e){theValue[e]=$(this).attr("the_id");theName[e]=$(this).attr("valor");console.log(theName[e])})}else if(filterType=="select"){theValue=e.parent().find(".selected").attr("the_id");theName=e.parent().find(".selected").attr("valor")}else filterType=="slider"?theValue="es un slider":filterType=="sliderRange"&&(theValue="es un sliderrange");if(jQuery.isEmptyObject(filtersOutputArray)){filtersOutputArray[entity]=new Object;filtersOutputArray[entity][filterName]=theValue;filtersLiteralOutputArray[entity]=new Object;filtersLiteralOutputArray[entity][filterName]=theName}else for(var t in filtersOutputArray)if(filtersOutputArray.hasOwnProperty(entity)){filtersOutputArray[entity][filterName]=theValue;filtersLiteralOutputArray[entity][filterName]=theName}else{filtersOutputArray[entity]=new Object;filtersOutputArray[entity][filterName]=theValue;filtersLiteralOutputArray[entity]=new Object;filtersLiteralOutputArray[entity][filterName]=theName}}var filtersArray=new Array,filtersOutputArray=new Object,filtersLiteralOutputArray=new Object;