function removeFilter(e){$(".filterBall").parent().find(".formFilter").addClass("formFilterClosed");$(".filterBall").parent().find(".filterGlobalList").addClass("filterListClosed");$(".filterBall").find(".arrow").addClass("arrowClosed");$(".filterBall").addClass("filterBallClosed");$("#entitiesList").addClass("filterListClosed");$(".filters."+e).remove();filtersArray.splice(filtersArray.indexOf(e),1);delete filtersOutputArray["eid"+e];delete filtersLiteralOutputArray["eid"+e];delete EspecificOutputArray["eid"+e]}function loadFilter(e,t,n){$(".filterBall").parent().find(".formFilter").addClass("formFilterClosed");$(".filterBall").parent().find(".filterGlobalList").addClass("filterListClosed");$(".filterBall").find(".arrow").addClass("arrowClosed");$(".filterBall").addClass("filterBallClosed");$("#entitiesList").addClass("filterListClosed");getFilterData(e.url,t,e.name,n)}function getFilterData(e,t,n,r){$.ajax({url:e,type:"GET",dataType:"json",success:function(e){showFilterData(e,t,n,r)},error:function(e){alert("ERROR while loading JSON")}})}function parseAllFilters(e){$.each(e,function(e,t){var n=$("<li>",{entity_id:e+1,"class":t.name.toLowerCase(),eid:"eid"+(e+1)}).append($("<div>",{"class":"colorCode shadow1"})).append(t.name);n.data("filter",t);$("#entitiesList ul").append(n);formHTML="<div class='form_"+(e+1)+"'><form>";$.each(t.data,function(e,t){formType=t.type;if(formType=="list"){if(t.multiselect)var n="multiSelect";else var n="select";formHTML+="<fieldset filtertype='"+n+"' filtername='"+t.name+"'>";formHTML+="<label class='formSection'>"+t.name+"</label>";formHTML+="<div class='filterList formFilterItem'><ul>";for(i in t.data)formHTML+="<li the_id='"+(parseInt(i)+1)+"' valor='"+t.data[i]+"'>"+t.data[i]+"</li>";formHTML+="</ul></div></fieldset>"}else if(formType=="rangeslider"){formHTML+="<fieldset filtertype='slideRange' filtername='"+t.name+"'>";formHTML+="<label class='formSection'>"+t.name+"</label>";formHTML+="<div class='formFilterItem'>";formHTML+="<span class='output'></span>";t.step?formHTML+="<div class='slider-range' min='"+t.data[0]+"' max='"+t.data[1]+"' step='"+t.step+"'></div>":formHTML+="<div class='slider-range' min='"+t.data[0]+"' max='"+t.data[1]+"' ></div>";formHTML+="</div></fieldset>"}else if(formType=="text"){formHTML+="<fieldset filtertype='text' filtername='"+t.name+"'>";formHTML+="<label class='formSection formSectionText'>"+t.name+"</label><div class='filterList formFilterItem'><input type='text' /></div>";formHTML+="</fieldset>"}});formHTML+="</form></div>";$("#footage").append(formHTML)});loadClicks()}function loadClicks(){$("#results .desc .plus").click(function(){$(this).parent().parent().toggleClass("open");var e=$("#results");e.packery({itemSelector:".item",gutter:0})});$(".item .similarity div").click(function(){$(".item .similarity div").removeClass("active");theparent=$(this).parent();buscar=".right .similarList "+$(this).attr("class");theparent.parent().parent().find(buscar).addClass("active");$(this).addClass("active")});$("#query").click(function(){console.log("filtersArray");console.log(filtersArray);console.log("-------------------------");console.log("filtersOutputArray");console.log(filtersOutputArray);console.log("-------------------------");console.log("filtersLiteralOutputArray");console.log(filtersLiteralOutputArray);console.log("-------------------------");console.log("EspecificOutputArray");console.log(EspecificOutputArray);console.log("-------------------------");var e="/carnatic/?q=1";for(var t=0;t<EspecificOutputArray.eid1.length;t++){n=EspecificOutputArray.eid1[t];e+="&a="+n}console.log(e);window.location.href=e});$("#gmSelected").click(function(){$("#gmDropDown").fadeIn()});$("#gmDropDown").click(function(){$("#gmDropDown").fadeOut()});$("#entitiesList ul li").click(function(){$(this).hasClass("selected")?removeFilter($(this).attr("class").split(" ")[0]):loadFilter($(this).data("filter"),$(this).attr("entity_id"),$(this).attr("eid"));$(this).toggleClass("selected");$("#summary").attr("class",$(this).attr("class"))});$(".formFilterItem ul li").click(function(){$(this).toggleClass("selected");entity=$(this).parent().parent().parent().parent().parent().parent().parent().attr("eid");filterType=$(this).parent().parent().parent().attr("filtertype");filterName=$(this).parent().parent().parent().attr("filtername");getResults($(this))});$(".formSection").click(function(){$(this).toggleClass("formSectionOpen");$(this).nextAll(".formFilterItem").toggle();$(".formSection").not(this).removeClass("formSectionOpen");$(".formSection").not(this).nextAll(".formFilterItem").hide();topPosition=$(this).position();container=$(this).parent().parent().parent().parent();container.scrollTop(topPosition.top-10);$(this).hasClass("formSectionOpen")?container.addClass("noScroll"):container.removeClass("noScroll")});$(".filterBall").click(function(){nuk=$(this);if($(this).hasClass("filterBallClosed")){$(".filterBall").not(this).parent().find(".formFilter").addClass("formFilterClosed");$(".filterBall").not(this).parent().find(".filterGlobalList").addClass("filterListClosed");$("#entitiesList").addClass("filterListClosed");$(".filterBall").not(this).find(".arrow").addClass("arrowClosed");$(".filterBall").not(this).addClass("filterBallClosed");nuk.find(".arrow").removeClass("arrowClosed");nuk.removeClass("filterBallClosed");nuk.siblings(".formFilter").removeClass("formFilterClosed");nuk.siblings(".filterGlobalList").removeClass("filterListClosed");nuk.siblings("#entitiesList").removeClass("filterListClosed");sumarizeFilter($(this))}else{$(".filterBall").parent().find(".formFilter").addClass("formFilterClosed");$(".filterBall").parent().find(".filterGlobalList").addClass("filterListClosed");$(".filterBall").find(".arrow").addClass("arrowClosed");$(".filterBall").addClass("filterBallClosed");$("#entitiesList").addClass("filterListClosed");sumarizeFilter($(this))}});$("#toggleMain").click(function(){$("#filterMask").toggleClass("querybar");populateBreadcrumbs()})}function populateBreadcrumbs(){entityHTML_bc="";hay="no";for(i in filtersArray){entity_name="eid"+filtersArray[i];entity_realName=$("#entitiesList ul li[eid='"+entity_name+"']").text().toLowerCase();entityHTML_bc+="<div class='bread entity_"+entity_name+" "+entity_realName+"'><div class='breadarrow'></div><span><a href='#'>";entityHTML_bc+="<h3>"+entity_realName+"</h3>";if(filtersLiteralOutputArray[entity_name]){$.each(filtersLiteralOutputArray[entity_name],function(e,t){entityHTML_bc+=e+"- "+t+"<br>"});hay="yes"}else hay="no";for(i in EspecificOutputArray[entity_name]){especific_name=EspecificOutputArray[entity_name][i];entityHTML_bc+=especific_name+" ";hay="yes"}hay=="no"&&(entityHTML_bc+="Nothing selected");entityHTML_bc+="</a></span></div>"}$("#breadcrumb").html(entityHTML_bc)}function sumarizeFilter(e){entity_name=e.parent().attr("eid");summaryHTML="";jQuery.isEmptyObject(filtersLiteralOutputArray)||$.each(filtersLiteralOutputArray[entity_name],function(e,t){elsvalors=t.join("<br>·");summaryHTML+="<b>"+e+"</b></br>·"+elsvalors+"</br>"});if(!jQuery.isEmptyObject(EspecificOutputArray)){summaryHTML+="<b>Selection</b><br>";$.each(EspecificOutputArray[entity_name],function(e,t){summaryHTML+=t+"</br>"})}e.find(".filterSummary").html(summaryHTML)}function showFilterData(e,t,n,r){filtersArray.push(t);filterPosition=filtersArray.indexOf(t);$("#filterModel").clone(!0).prependTo("#filterArea").attr("id","filter_"+filterPosition).attr("class","filters entity_"+t+" "+n.toLowerCase()).attr("eid",r);$("#filterArea").width(480+filtersArray.length*780);newFilter="#filter_"+filterPosition;$(newFilter).find(".filterList").append(listFilterData(e,t));$(newFilter).find(".filterBall span").html(n);$(".form_"+t).clone(!0).appendTo($(newFilter).find(".formFilter"));$(newFilter+" .formFilter").removeClass("formFilterClosed");$(newFilter+" .filterList").removeClass("filterListClosed");$(newFilter+" .filterBall .arrow").removeClass("arrowClosed");$(newFilter+" .filterBall").removeClass("filterBallClosed");$(newFilter+" .slider-range").each(function(){$(this).attr("step")?$(this).slider({range:!0,min:parseInt($(this).attr("min")),max:parseInt($(this).attr("max")),step:parseInt($(this).attr("step")),values:[parseInt($(this).attr("min")),parseInt($(this).attr("max"))],slide:function(e,t){$(newFilter).find(".output").html(t.values[0]+" - "+t.values[1]+"<div class='results' first='"+t.values[0]+"' second='"+t.values[1]+"'></div>")}}):$(this).slider({range:!0,min:parseInt($(this).attr("min")),max:parseInt($(this).attr("max")),values:[parseInt($(this).attr("min")),parseInt($(this).attr("max"))],slide:function(e,t){$(newFilter).find(".output").html(t.values[0]+" - "+t.values[1]+"<div class='results' first='"+t.values[0]+"' second='"+t.values[1]+"'></div>")}})});$(newFilter).find(".output").each(function(){$(this).html($(this).siblings().attr("min")+" - "+$(this).siblings().attr("max"))});$(newFilter).find("input").bind("slider:ready slider:changed",function(e,t){if($(this).hasClass("artistGeneration")){result=1912+t.value.toFixed(2)*100;$(this).parent().find(".output").html(result.toFixed())}else{result=t.value.toFixed(2)*100;$(this).parent().find(".output").html(result.toFixed());console.log("change")}})}function listFilterData(e,t){list="<ul>";$.each(e,function(e,t){t.name?list+="<li>"+t.name+"</li>":list+="<li>"+t.title+"</li>"});list+="</ul>";return list}function getResults(e){theValue="";theName="";if(filterType=="multiSelect"){theValue=[];theName=[];e.parent().find(".selected").each(function(e){theValue[e]=$(this).attr("the_id");theName[e]=$(this).attr("valor")})}else if(filterType=="select"){theValue=e.parent().find(".selected").attr("the_id");theName=e.parent().find(".selected").attr("valor")}else filterType=="slider"?theValue="es un slider":filterType=="sliderRange"&&(theValue="es un sliderrange");if(jQuery.isEmptyObject(filtersOutputArray)){filtersOutputArray[entity]=new Object;filtersOutputArray[entity][filterName]=theValue;filtersLiteralOutputArray[entity]=new Object;filtersLiteralOutputArray[entity][filterName]=theName}else for(var t in filtersOutputArray)if(filtersOutputArray.hasOwnProperty(entity)){filtersOutputArray[entity][filterName]=theValue;filtersLiteralOutputArray[entity][filterName]=theName}else{filtersOutputArray[entity]=new Object;filtersOutputArray[entity][filterName]=theValue;filtersLiteralOutputArray[entity]=new Object;filtersLiteralOutputArray[entity][filterName]=theName}}function getResults2(e,t){theValue="";theValue=e.html();if(jQuery.isEmptyObject(EspecificOutputArray)){EspecificOutputArray[t]=new Array;EspecificOutputArray[t].push(theValue)}else if(EspecificOutputArray.hasOwnProperty(t)){existeix="no";for(var n in EspecificOutputArray[t])if(EspecificOutputArray[t][n]==theValue){EspecificOutputArray[t].splice(n,1);existeix="si"}existeix=="no"&&EspecificOutputArray[t].push(theValue)}else{EspecificOutputArray[t]=new Array;EspecificOutputArray[t].push(theValue)}}var filtersArray=new Array,filtersOutputArray=new Object,filtersLiteralOutputArray=new Object,EspecificOutputArray=new Object,globalSpeed=500;$(document).ready(function(){widthOfChildren(".scrollblock");$("#filterArea").on("click",".filterList.filterGlobalList ul li",function(){$(this).toggleClass("selected");entity=$(this).parent().parent().parent().attr("eid");getResults2($(this),entity)});var e=$("#results");e.packery({itemSelector:".item",gutter:0})});